#顺序一致性

顺序一致性内存模型是一个理论参考模型，在设计时，处理器和编程语言的内存模型会以此为参考

## 顺序一致性内存模型

两大特征
1. 一个线程中的所有操作必须按照程序的顺序来执行
2. 所有线程都只能看到一个单一的操作执行顺序。在顺序一致性内存模型中，每个操作都必须原子执行且立刻对所有线程可见

当多个线程并发执行时，把所有线程的所有内存读/写操作串行化（所有操作之间具有全序关系）

但在JMM中没有这些保证，未同步的程序不但整体执行顺序是无序的，而且所有线程看到的操作执行顺序也可能不一致（当前线程写的数据存储在本地内存中，没有刷新回主内存前对其他线程不可见）

在JMM中，临界区（同步代码块）内的代码可以重排序，JMM的优化方针为：在不改变程序执行结果的前提下，尽可能为编译器和处理器的优化提供帮助

JMM内存模型与顺序一致性内存模型的差异
1. 顺序一致性模型保证单线程内的操作按程序的顺序执行，JMM不保证（重排序）
2. 顺序一致性模型保证所有线程只能看到一致的操作执行顺序，JMM不保证（工作内存与主内存）
3. JMM不保证对64位的long型和double型变量的写操作有原子性（32位处理器上，Java语言规范鼓励但不强求JVM对64位的long与double的写操作有原子性，JVM有可能把64位的写操作拆分为两个32位的操作），顺序一致性保证对所有内存的读/写操作都具有原子性
