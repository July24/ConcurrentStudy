# 并发编程的挑战
## 上下文切换

> CPU通过时间片分配算法来循环执行任务，当前任务执行一个时间片后会切换到下一个任务。但是，切换前会保存上一个任务的状态，以便下次切换回这个任务时可以加载到这个任务的状态，从任务保存到在加载的过程叫做 **上下文切换** 。

*并发不一定比串行快，因为并发涉及到线程的创建和上下文的切换*

减少上下文切换的方法：
* 无锁并发编程。多线程竞争锁时，会引起上下文切换，所以用多线程处理数据时，可以用一些办法来避免使用锁，如将数据ID按照Hash算法取模分段，不同的线程处理不同段的数据
* CAS算法。Java的Atomic包使用CAS算法来更新数据，不需要加锁
* 使用最少线程
* 协程：在单线程里实现多任务的调度，并在单线程里维持多个任务间的切换
---
## 死锁
执行程序中两个以上的线程发生永久阻塞，每个线程都在等待被其他线程占用的资源

Demo：[死锁Demo](DeadLockDemo.java)

常用避免死锁的方法:
1. 避免在一个线程里使用多个锁
2. 避免一个线程在锁内同时占用多个资源，尽量保证每个锁只占用一个资源
3. 尝试使用定时锁，使用Lock.tryLock(timeout) 来替代使用内部锁机制
4. 对于数据库锁，加锁和解锁必须在一个数据库连接内，否则会出现解锁失败的情况
---

##资源限制
>资源限制是指在并发编程时，程序执行速度受限于计算机的软硬件资源。
>
>例如，服务器带宽只有2MB/s，某个资源下载速度是1MB/s，起10个线程去下载资源下载速度不会变成10MB/s。硬盘读写速度、数据库链接数等

存在的问题：
>并发编程中，将代码执行速度加快是将串行执行部分变为并发执行，但是如果将某段串行代码并发执行，受限于资源限制，依然在串行执行，因为增加了上下文切换和资源调度反而执行的会更慢

问题的解决：
>对于硬件资源问题可以通过集群来解决。
>
>对于软件资源问题可以考虑将资源池复用。



